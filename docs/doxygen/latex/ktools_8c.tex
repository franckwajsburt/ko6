\hypertarget{ktools_8c}{\section{/users/enseig/franck/ko6/src/soft/fs/kfs/ktools.c File Reference}
\label{ktools_8c}\index{/users/enseig/franck/ko6/src/soft/fs/kfs/ktools.\-c@{/users/enseig/franck/ko6/src/soft/fs/kfs/ktools.\-c}}
}
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$getopt.\-h$>$}\\*
{\ttfamily \#include $<$ftw.\-h$>$}\\*
{\ttfamily \#include $<$sys/stat.\-h$>$}\\*
{\ttfamily \#include \char`\"{}kfs.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{ktools_8c_a157a956e14c5c44b3f73ef23a4776f64}{L\-I\-N\-U\-X}
\item 
\#define \hyperlink{ktools_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}~500
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \{ \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}{C\-M\-D\-\_\-\-D\-U\-M\-M\-Y}, 
\hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}{C\-M\-D\-\_\-\-T\-R\-E\-E}, 
\hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5}{C\-M\-D\-\_\-\-B\-U\-I\-L\-D}, 
\hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921}{C\-M\-D\-\_\-\-S\-P\-L\-I\-T}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
char $\ast$ \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup} (const char $\ast$s)
\item 
char $\ast$ \hyperlink{ktools_8c_a30830920b754d844291af7d136d6b5c1}{kfs\-\_\-absolute\-\_\-pathname} (int dentry)
\item 
void \hyperlink{ktools_8c_a248e1d9ae859f3b9f7933b506846c667}{kfs\-\_\-print\-\_\-dentry} (int dentry, int depth, int position)
\item 
void \hyperlink{ktools_8c_a54c8f883a16767e5c05750fc425c525c}{kfs\-\_\-tree} (char $\ast$name)
\item 
void \hyperlink{ktools_8c_a1ba276cff72866fb0ad856572a87ba35}{kfs\-\_\-print\-\_\-files} (int dentry, int depth, int position)
\item 
void \hyperlink{ktools_8c_a2acd3e2ba6581eac5ff5e2a78ffa9bd8}{kfs\-\_\-files} (char $\ast$name)
\item 
char $\ast$ \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess} (char $\ast$s)
\item 
void \hyperlink{ktools_8c_a9b68125aeb10ab39a0981d0fa952d5f1}{dummy\-\_\-disk} (void)
\item 
void \hyperlink{ktools_8c_a39f344acada2bd8574dfb5da41938905}{add\-\_\-new\-\_\-file} (const char $\ast$host\-\_\-file, int kfs\-\_\-dentry)
\item 
int \hyperlink{ktools_8c_a521c1fd005bd6738b695d604843e880c}{build} (const char $\ast$fpath, const struct stat $\ast$sb, int typeflag, struct F\-T\-W $\ast$ftwbuf)
\item 
void \hyperlink{ktools_8c_a16c0ecb37b34e241fab9b9be0ebf7c6f}{split} (int dentry, int depth, int position)
\item 
void \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage} (void)
\item 
void \hyperlink{ktools_8c_a78949f4960804d06e92c2b349740243f}{getoption} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\item 
int \hyperlink{ktools_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
char $\ast$$\ast$ \hyperlink{ktools_8c_ab4fad31452ea2612bd37240026dd6e44}{Argv}
\item 
int \hyperlink{ktools_8c_a34296df812d7c5468ae201c7eeca5877}{Argc}
\item 
int \hyperlink{ktools_8c_a95f627d7054b1abbffa2c6ea19bf05db}{Verbose}
\item 
int \hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command}
\item 
char $\ast$ \hyperlink{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{Mbr\-File\-Name}
\item 
char $\ast$ \hyperlink{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{Boot\-File\-Name}
\item 
char $\ast$ \hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{Dir\-Name}
\item 
char $\ast$ \hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{Kfs\-Disk\-Name}
\item 
char $\ast$ \hyperlink{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{Opt\-C\-Pathname}
\item 
char $\ast$ \hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{Opt\-C\-New\-File}
\item 
int \hyperlink{ktools_8c_aebd6c8ef38afc2cfd9a6db1ed746e28d}{Opt\-F} = 0
\item 
static char \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer} \mbox{[}1$<$$<$ 12\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{ktools_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}{\index{ktools.\-c@{ktools.\-c}!\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E@{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}}
\index{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E@{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}!ktools.c@{ktools.\-c}}
\subsubsection[{\-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define \-\_\-\-X\-O\-P\-E\-N\-\_\-\-S\-O\-U\-R\-C\-E~500}}\label{ktools_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}
\hypertarget{ktools_8c_a157a956e14c5c44b3f73ef23a4776f64}{\index{ktools.\-c@{ktools.\-c}!L\-I\-N\-U\-X@{L\-I\-N\-U\-X}}
\index{L\-I\-N\-U\-X@{L\-I\-N\-U\-X}!ktools.c@{ktools.\-c}}
\subsubsection[{L\-I\-N\-U\-X}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-I\-N\-U\-X}}\label{ktools_8c_a157a956e14c5c44b3f73ef23a4776f64}


\subsection{Enumeration Type Documentation}
\hypertarget{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7}{\subsubsection[{anonymous enum}]{\setlength{\rightskip}{0pt plus 5cm}anonymous enum}}\label{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{C\-M\-D\-\_\-\-D\-U\-M\-M\-Y@{C\-M\-D\-\_\-\-D\-U\-M\-M\-Y}!ktools.\-c@{ktools.\-c}}\index{ktools.\-c@{ktools.\-c}!C\-M\-D\-\_\-\-D\-U\-M\-M\-Y@{C\-M\-D\-\_\-\-D\-U\-M\-M\-Y}}\item[{\em 
\hypertarget{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}{C\-M\-D\-\_\-\-D\-U\-M\-M\-Y}\label{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}
}]\index{C\-M\-D\-\_\-\-T\-R\-E\-E@{C\-M\-D\-\_\-\-T\-R\-E\-E}!ktools.\-c@{ktools.\-c}}\index{ktools.\-c@{ktools.\-c}!C\-M\-D\-\_\-\-T\-R\-E\-E@{C\-M\-D\-\_\-\-T\-R\-E\-E}}\item[{\em 
\hypertarget{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}{C\-M\-D\-\_\-\-T\-R\-E\-E}\label{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}
}]\index{C\-M\-D\-\_\-\-B\-U\-I\-L\-D@{C\-M\-D\-\_\-\-B\-U\-I\-L\-D}!ktools.\-c@{ktools.\-c}}\index{ktools.\-c@{ktools.\-c}!C\-M\-D\-\_\-\-B\-U\-I\-L\-D@{C\-M\-D\-\_\-\-B\-U\-I\-L\-D}}\item[{\em 
\hypertarget{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5}{C\-M\-D\-\_\-\-B\-U\-I\-L\-D}\label{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5}
}]\index{C\-M\-D\-\_\-\-S\-P\-L\-I\-T@{C\-M\-D\-\_\-\-S\-P\-L\-I\-T}!ktools.\-c@{ktools.\-c}}\index{ktools.\-c@{ktools.\-c}!C\-M\-D\-\_\-\-S\-P\-L\-I\-T@{C\-M\-D\-\_\-\-S\-P\-L\-I\-T}}\item[{\em 
\hypertarget{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921}{C\-M\-D\-\_\-\-S\-P\-L\-I\-T}\label{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921}
}]\end{description}
\end{Desc}

\begin{DoxyCode}
58      \{
59     \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}{CMD\_DUMMY},
60     \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}{CMD\_TREE},
61     \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5}{CMD\_BUILD},
62     \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921}{CMD\_SPLIT}
63 \};
\end{DoxyCode}


\subsection{Function Documentation}
\hypertarget{ktools_8c_a39f344acada2bd8574dfb5da41938905}{\index{ktools.\-c@{ktools.\-c}!add\-\_\-new\-\_\-file@{add\-\_\-new\-\_\-file}}
\index{add\-\_\-new\-\_\-file@{add\-\_\-new\-\_\-file}!ktools.c@{ktools.\-c}}
\subsubsection[{add\-\_\-new\-\_\-file}]{\setlength{\rightskip}{0pt plus 5cm}void add\-\_\-new\-\_\-file (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{host\-\_\-file, }
\item[{int}]{kfs\-\_\-dentry}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a39f344acada2bd8574dfb5da41938905}


References buffer, kfs\-\_\-set\-\_\-size(), kfs\-\_\-write(), memset(), and read().



Referenced by build(), and main().


\begin{DoxyCode}
273 \{
274     \textcolor{keywordtype}{int} page\_offset = 0;
275     \textcolor{keywordtype}{int} nb\_bytes\_read = 0;
276 
277     \textcolor{comment}{/* Try to open the host's file */}
278     \textcolor{keywordtype}{int} fd = open(host\_file, O\_RDONLY);
279 
280     \textcolor{comment}{/* Prepare buffer to receive the first page of the file */}
281     \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset} (\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 0, 1<<12);
282 
283     \textcolor{comment}{/* Read the file, in chunks of 4kib, and write its content to the kfs pathname via the buffer */}
284     \textcolor{keywordflow}{while} ((nb\_bytes\_read = \hyperlink{libc_8c_aec19a0626d6167a834fa9f5b25214f7f}{read}(fd, \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 1<<12)))
285     \{
286         \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write}(kfs\_dentry, page\_offset, \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer});
287         \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(kfs\_dentry, nb\_bytes\_read + (page\_offset<<12));
288         page\_offset++;
289         \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset} (\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 0, 1<<12);
290     \}
291 
292     \textcolor{comment}{/* Close the file descriptor of the host's file */}
293     close(fd);
294 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a521c1fd005bd6738b695d604843e880c}{\index{ktools.\-c@{ktools.\-c}!build@{build}}
\index{build@{build}!ktools.c@{ktools.\-c}}
\subsubsection[{build}]{\setlength{\rightskip}{0pt plus 5cm}int build (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{fpath, }
\item[{const struct stat $\ast$}]{sb, }
\item[{int}]{typeflag, }
\item[{struct F\-T\-W $\ast$}]{ftwbuf}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a521c1fd005bd6738b695d604843e880c}


References add\-\_\-new\-\_\-file(), free(), kfs\-\_\-open(), malloc(), and strlen().



Referenced by main().


\begin{DoxyCode}
311 \{
312     \textcolor{comment}{/* 1st call : if the pathname is not a directory that can be read, return 1 to stop the walk */}
313     \textcolor{keywordflow}{if} ((ftwbuf->level == 0) && (typeflag != FTW\_D))
314     \{
315         printf(\textcolor{stringliteral}{"%s is not a directory that can be read\(\backslash\)n"}, fpath);
316         \textcolor{keywordflow}{return} 1;
317     \}
318 
319     \textcolor{comment}{/* 1st call : if the pathname is a valid directory the walk can continue */}
320     \textcolor{keywordflow}{if} ((ftwbuf->level == 0) && (typeflag == FTW\_D))
321     \{
322         \textcolor{keywordflow}{return} 0;
323     \}
324 
325     \textcolor{comment}{/* Subsequent calls : start with creating a new dentry in kfs  */}
326     \textcolor{keywordtype}{char}* new\_dentry\_name = \hyperlink{memory_8c_a7ac38fce3243a7dcf448301ee9ffd392}{malloc}(\hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(fpath) + 2);
327     sprintf(new\_dentry\_name, \textcolor{stringliteral}{"/%s"}, fpath);
328     \textcolor{keywordtype}{int} kfs\_dentry = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open}(new\_dentry\_name);
329     \hyperlink{memory_8c_afbedc913aa4651b3c3b4b3aecd9b4711}{free}(new\_dentry\_name);
330 
331     \textcolor{comment}{/* If it is a regular file, write its content to kfs */}
332     \textcolor{keywordflow}{if} (typeflag == FTW\_F)
333     \{
334         \hyperlink{ktools_8c_a39f344acada2bd8574dfb5da41938905}{add\_new\_file}(fpath, kfs\_dentry);
335 
336         \textcolor{keywordflow}{return} 0;
337     \}
338 
339     \textcolor{comment}{/* If it is a directory, there isn't anything more to do */}
340     \textcolor{keywordflow}{if} (typeflag == FTW\_D)
341     \{
342         \textcolor{comment}{/* In kfs, set the dentry type to directory ??? */}
343 
344         \textcolor{keywordflow}{return} 0;
345     \}
346 
347     \textcolor{comment}{/* If it is not any of the above, return an error to stop the walk */}
348     \textcolor{keywordflow}{return} 2;
349 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a9b68125aeb10ab39a0981d0fa952d5f1}{\index{ktools.\-c@{ktools.\-c}!dummy\-\_\-disk@{dummy\-\_\-disk}}
\index{dummy\-\_\-disk@{dummy\-\_\-disk}!ktools.c@{ktools.\-c}}
\subsubsection[{dummy\-\_\-disk}]{\setlength{\rightskip}{0pt plus 5cm}void dummy\-\_\-disk (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a9b68125aeb10ab39a0981d0fa952d5f1}


References buffer, kfs\-\_\-link(), kfs\-\_\-open(), kfs\-\_\-openat(), kfs\-\_\-read(), kfs\-\_\-set\-\_\-size(), kfs\-\_\-tree(), kfs\-\_\-write(), and mess().



Referenced by main().


\begin{DoxyCode}
224 \{
225     \textcolor{keywordtype}{int} fd[32];
226     \textcolor{keywordtype}{char} \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}[1<<12];
227 
228     fd[0] = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open} (\textcolor{stringliteral}{"/bin/app.x"});
229     fd[1] = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open} (\textcolor{stringliteral}{"/home"});
230     fd[2] = \hyperlink{kfs_8c_a5bf1c4cc42e02a99529eefc02cf53c4b}{kfs\_openat} (fd[1], \textcolor{stringliteral}{"angie"});
231     fd[3] = \hyperlink{kfs_8c_a5bf1c4cc42e02a99529eefc02cf53c4b}{kfs\_openat} (fd[2], \textcolor{stringliteral}{"lena1.pgm"});
232     fd[4] = \hyperlink{kfs_8c_a5bf1c4cc42e02a99529eefc02cf53c4b}{kfs\_openat} (fd[1], \textcolor{stringliteral}{"franck"});
233     fd[5] = \hyperlink{kfs_8c_a5bf1c4cc42e02a99529eefc02cf53c4b}{kfs\_openat} (fd[1], \textcolor{stringliteral}{"francois"});
234     fd[6] = \hyperlink{kfs_8c_a4fa0207fb8a04e889050f380b9068e3a}{kfs\_link} (\textcolor{stringliteral}{"/home/angie/lena1.pgm"}, \textcolor{stringliteral}{"/home/lena2.pgm"});
235 
236     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 0, \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour0"}));
237     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], 8);
238 
239     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 3,  \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour3"}));
240     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], (3<<12) + 8);
241 
242     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 13, \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour13"}));
243     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], (13<<12) + 9);
244 
245     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 27, \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour27"}));
246     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], (27<<12) + 9);
247 
248     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 28, \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour28"}));
249     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], (28<<12) + 9);
250 
251     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 29, \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour29"}));
252     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], (29<<12) + 9);
253 
254     \hyperlink{kfs_8c_a57b5123b2f69a99505a7f3026eeefce9}{kfs\_write} (fd[3], 30, \hyperlink{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{mess}(\textcolor{stringliteral}{"Bonjour30"}));
255     \hyperlink{kfs_8c_a491e452cdf42853498249aadc91eb74b}{kfs\_set\_size}(fd[3], (30<<12) + 9);
256 
257     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3],  0, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 0, buffer);}
258     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3],  3, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 3, buffer);}
259     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3], 13, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 13, buffer);}
260     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3], 27, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 27, buffer);}
261     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3], 28, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 28, buffer);}
262     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3], 29, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 29, buffer);}
263     \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read} ( fd[3], 30, (\textcolor{keywordtype}{void} *)buffer); \textcolor{comment}{//fprintf (stderr, "%d:%s\(\backslash\)n", 30, buffer);}
264 
265     \hyperlink{ktools_8c_a54c8f883a16767e5c05750fc425c525c}{kfs\_tree} (\textcolor{stringliteral}{"/"});
266 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a78949f4960804d06e92c2b349740243f}{\index{ktools.\-c@{ktools.\-c}!getoption@{getoption}}
\index{getoption@{getoption}!ktools.c@{ktools.\-c}}
\subsubsection[{getoption}]{\setlength{\rightskip}{0pt plus 5cm}void getoption (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a78949f4960804d06e92c2b349740243f}


References Argc, Argv, atoi(), Boot\-File\-Name, C\-M\-D\-\_\-\-B\-U\-I\-L\-D, C\-M\-D\-\_\-\-D\-U\-M\-M\-Y, C\-M\-D\-\_\-\-S\-P\-L\-I\-T, C\-M\-D\-\_\-\-T\-R\-E\-E, Command, Dir\-Name, Kfs\-Disk\-Name, Mbr\-File\-Name, N\-U\-L\-L, Opt\-C\-New\-File, Opt\-C\-Pathname, Opt\-F, strcmp(), strdup(), usage(), and Verbose.



Referenced by main().


\begin{DoxyCode}
431 \{
432     \textcolor{keywordtype}{char} option;
433 
434     \hyperlink{ktools_8c_a34296df812d7c5468ae201c7eeca5877}{Argc} = argc;
435     \hyperlink{ktools_8c_ab4fad31452ea2612bd37240026dd6e44}{Argv} = argv;
436 
437     \textcolor{comment}{// optional arguments}
438     \textcolor{comment}{// ------------------------------------------------------------------}
439     \textcolor{keywordflow}{while} ((option = getopt (argc, argv, \textcolor{stringliteral}{"hv:m:b:c:f"})) != EOF) \{
440         \textcolor{keywordflow}{switch} (option) \{
441         \textcolor{keywordflow}{case} \textcolor{charliteral}{'v'}:
442             \hyperlink{ktools_8c_a95f627d7054b1abbffa2c6ea19bf05db}{Verbose} = \hyperlink{cstd_8c_ad4e7081d9e427a55fedef2ceab5f6244}{atoi}(optarg);
443             \textcolor{keywordflow}{if} ((\hyperlink{ktools_8c_a95f627d7054b1abbffa2c6ea19bf05db}{Verbose} < 0) || (\hyperlink{ktools_8c_a95f627d7054b1abbffa2c6ea19bf05db}{Verbose} > 2))
444                 \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage} ();
445             \textcolor{keywordflow}{break};
446         \textcolor{keywordflow}{case} \textcolor{charliteral}{'m'}:
447             \hyperlink{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{MbrFileName} = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup} (optarg);
448             \textcolor{comment}{// FIXME verfier exension et type}
449             \textcolor{keywordflow}{break};
450         \textcolor{keywordflow}{case} \textcolor{charliteral}{'b'}:
451             \hyperlink{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{BootFileName} = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup} (optarg);
452             \textcolor{comment}{// FIXME verfier exension et type}
453             \textcolor{keywordflow}{break};
454 \textcolor{preprocessor}{#if 0}
455 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \textcolor{charliteral}{'c'}:
456             \textcolor{comment}{/* FIXME Ajouter les v√©rifications */}
457             \textcolor{keywordtype}{char} * optCArg = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup}(optarg);
458 
459             \hyperlink{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{OptCPathname} = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup}(strtok(optCArg, \textcolor{stringliteral}{":"}));
460             \hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{OptCNewFile} = strtok(\hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \textcolor{stringliteral}{""});
461 
462             \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{OptCNewFile})
463                 \hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{OptCNewFile} = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup}(\hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{OptCNewFile});
464 
465             \textcolor{keywordflow}{break};
466 \textcolor{preprocessor}{#endif}
467 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \textcolor{charliteral}{'f'}:
468             \hyperlink{ktools_8c_aebd6c8ef38afc2cfd9a6db1ed746e28d}{OptF} = 1;
469             \textcolor{keywordflow}{break};
470         \textcolor{keywordflow}{default}:
471             \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage} ();
472         \}
473     \}
474 
475     \textcolor{comment}{// mandatory arguments}
476     \textcolor{comment}{// ------------------------------------------------------------------}
477     \textcolor{keywordflow}{if} (optind < argc) \{
478         \textcolor{keywordflow}{if} (\hyperlink{cstd_8c_a11bd144d7d44914099a3aeddf1c8567d}{strcmp} (argv[optind], \textcolor{stringliteral}{"dummy"})==0)  \hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command} = \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}{CMD\_DUMMY}; \textcolor{keywordflow}{else}
479         \textcolor{keywordflow}{if} (\hyperlink{cstd_8c_a11bd144d7d44914099a3aeddf1c8567d}{strcmp} (argv[optind], \textcolor{stringliteral}{"build"})==0)  \hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command} = \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5}{CMD\_BUILD}; \textcolor{keywordflow}{else}
480         \textcolor{keywordflow}{if} (\hyperlink{cstd_8c_a11bd144d7d44914099a3aeddf1c8567d}{strcmp} (argv[optind], \textcolor{stringliteral}{"split"})==0)  \hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command} = \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921}{CMD\_SPLIT}; \textcolor{keywordflow}{else}
481         \textcolor{keywordflow}{if} (\hyperlink{cstd_8c_a11bd144d7d44914099a3aeddf1c8567d}{strcmp} (argv[optind], \textcolor{stringliteral}{"tree"})==0)   \hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command} = \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}{CMD\_TREE};  \textcolor{keywordflow}{else}
482         \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage}();
483         optind++;
484     \} \textcolor{keywordflow}{else} \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage}();
485 
486     \textcolor{keywordflow}{if} (optind < argc) \{
487         \textcolor{comment}{// FIXME verfier exension et type}
488         \hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName} = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup} (argv[optind]);
489         optind++;
490     \} \textcolor{keywordflow}{else} \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage}();
491 
492     \textcolor{comment}{// optional arguments that depend on command}
493     \textcolor{comment}{// ------------------------------------------------------------------}
494     \textcolor{comment}{/* if a DirName needs to be retrieved */}
495     \textcolor{keywordflow}{if} ((\hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command} != \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}{CMD\_DUMMY})&&(\hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command} != \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}{CMD\_TREE}) \(\backslash\)
496         &&(!\hyperlink{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{OptCPathname})&&(!\hyperlink{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{MbrFileName})&&(!\hyperlink{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{BootFileName})) \{
497         \textcolor{keywordflow}{if} (optind < argc) \{
498             \hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName} = \hyperlink{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{strdup} (argv[optind]);
499             \textcolor{comment}{// FIXME verfier exension et type}
500             optind++;
501         \}
502         \textcolor{keywordflow}{else} \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage}();
503     \}
504 
505     \textcolor{comment}{/* There should not be any more arguments at this point */}
506     \textcolor{keywordflow}{if} (optind != argc)
507         \hyperlink{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{usage}();
508 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a30830920b754d844291af7d136d6b5c1}{\index{ktools.\-c@{ktools.\-c}!kfs\-\_\-absolute\-\_\-pathname@{kfs\-\_\-absolute\-\_\-pathname}}
\index{kfs\-\_\-absolute\-\_\-pathname@{kfs\-\_\-absolute\-\_\-pathname}!ktools.c@{ktools.\-c}}
\subsubsection[{kfs\-\_\-absolute\-\_\-pathname}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ kfs\-\_\-absolute\-\_\-pathname (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a30830920b754d844291af7d136d6b5c1}


References kfs\-\_\-name(), kfs\-\_\-root(), memmove(), memset(), N\-U\-L\-L, strlen(), and strncpy().



Referenced by kfs\-\_\-print\-\_\-files(), and split().


\begin{DoxyCode}
88 \{
89     \textcolor{keyword}{static} \textcolor{keywordtype}{char} path[256];
90     \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset}(path, \textcolor{charliteral}{'\(\backslash\)0'}, 256);
91     \textcolor{keywordtype}{char}* current\_name;
92     \textcolor{keywordtype}{int} current\_name\_length;
93     \textcolor{keywordtype}{int} current\_dentry = dentry;
94     \textcolor{keywordtype}{int} i = 0;
95 
96     \textcolor{comment}{/* If dentry is the root, put '/' in path and return */}
97     \textcolor{keywordflow}{if} (!current\_dentry)
98     \{
99         path[0] = \textcolor{charliteral}{'/'};
100         \textcolor{keywordflow}{return} path;
101     \}
102 
103     \textcolor{comment}{/* If not, for each dentry, add its name at the beginning of the path string */}
104     \textcolor{keywordflow}{while}(current\_dentry)
105     \{
106         \textcolor{comment}{/* Assuming dentry names max len is 28, no more than 8 iterations for a path of len 256 */}
107         \textcolor{keywordflow}{if} (i >= 8) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
108 
109         \textcolor{comment}{/* Get the name of the current dentry */}
110         current\_name = \hyperlink{kfs_8c_a9d837cb422897570c876a655c0b762be}{kfs\_name}(current\_dentry);
111 
112         \textcolor{comment}{/* Move the path to be able to copy the current name at the beginning of the path */}
113         current\_name\_length = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(current\_name);
114         \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(path + current\_name\_length, path, \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(path));
115         \hyperlink{cstd_8c_a4803fe91b443c6cb7b6d21784aee33b0}{strncpy}(path, current\_name, current\_name\_length);
116 
117         \textcolor{comment}{/* Move the path again to add '/' at the very beginning */}
118         \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(path + 1, path, \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(path));
119         path[0] = \textcolor{charliteral}{'/'};
120 
121         \textcolor{comment}{/* In the next iteration, the dentry will have to be the root of the current one */}
122         current\_dentry = \hyperlink{kfs_8c_ade5bf93265bc86a9ecd5019cc6e3d277}{kfs\_root}(current\_dentry);
123 
124         \textcolor{comment}{/* Increment i which ensures that the absolute pathname cannot be longer than a given len */}
125         i++;
126     \}
127 
128     \textcolor{comment}{/* Add the null terminating character */}
129     path[\hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(path)] = \textcolor{charliteral}{'\(\backslash\)0'};
130 
131     \textcolor{keywordflow}{return} path;
132 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a2acd3e2ba6581eac5ff5e2a78ffa9bd8}{\index{ktools.\-c@{ktools.\-c}!kfs\-\_\-files@{kfs\-\_\-files}}
\index{kfs\-\_\-files@{kfs\-\_\-files}!ktools.c@{ktools.\-c}}
\subsubsection[{kfs\-\_\-files}]{\setlength{\rightskip}{0pt plus 5cm}void kfs\-\_\-files (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a2acd3e2ba6581eac5ff5e2a78ffa9bd8}


References kfs\-\_\-open(), kfs\-\_\-print\-\_\-files(), and kfs\-\_\-tree\-\_\-cb().



Referenced by main().


\begin{DoxyCode}
208 \{
209     \hyperlink{kfs_8c_a0c8753d9a11f6570f9c56b587fa2c48c}{kfs\_tree\_cb}(\hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open}(name), \hyperlink{ktools_8c_a1ba276cff72866fb0ad856572a87ba35}{kfs\_print\_files});
210 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a248e1d9ae859f3b9f7933b506846c667}{\index{ktools.\-c@{ktools.\-c}!kfs\-\_\-print\-\_\-dentry@{kfs\-\_\-print\-\_\-dentry}}
\index{kfs\-\_\-print\-\_\-dentry@{kfs\-\_\-print\-\_\-dentry}!ktools.c@{ktools.\-c}}
\subsubsection[{kfs\-\_\-print\-\_\-dentry}]{\setlength{\rightskip}{0pt plus 5cm}void kfs\-\_\-print\-\_\-dentry (
\begin{DoxyParamCaption}
\item[{int}]{dentry, }
\item[{int}]{depth, }
\item[{int}]{position}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a248e1d9ae859f3b9f7933b506846c667}


References buffer, kfs\-\_\-count(), K\-F\-S\-\_\-\-D\-I\-R, kfs\-\_\-inode(), kfs\-\_\-leaf(), kfs\-\_\-mode(), kfs\-\_\-mtime(), kfs\-\_\-name(), kfs\-\_\-next(), kfs\-\_\-owner(), kfs\-\_\-page(), kfs\-\_\-root(), kfs\-\_\-size(), kfs\-\_\-type(), and strlen().



Referenced by kfs\-\_\-tree().


\begin{DoxyCode}
139 \{
140     \textcolor{keywordtype}{char} \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}[256];                                       \textcolor{comment}{// formated filename}
141     \textcolor{keywordtype}{int} l;                                                  \textcolor{comment}{// directory level 0=root}
142     \textcolor{keywordtype}{char} types[4] = \{\textcolor{charliteral}{'d'},\textcolor{charliteral}{'-'},\textcolor{charliteral}{'p'},\textcolor{charliteral}{'l'}\};                      \textcolor{comment}{// type name}
143     \textcolor{keywordtype}{char} * owners[] = \{\textcolor{stringliteral}{"k "},\textcolor{stringliteral}{"u1"},\textcolor{stringliteral}{"u2"},\textcolor{stringliteral}{"u3"}\};                \textcolor{comment}{// owner's name}
144     \textcolor{keywordtype}{char} * name = \hyperlink{kfs_8c_a9d837cb422897570c876a655c0b762be}{kfs\_name} (dentry);                        \textcolor{comment}{// get entry name}
145     \textcolor{keywordtype}{int} inode = \hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\_inode}(dentry);                          \textcolor{comment}{// get the associated inode}
146     buffer[0]=0;                                            \textcolor{comment}{// clear the buffer}
147     \textcolor{keywordflow}{for} (l = depth; l; l--) strcat (buffer, \textcolor{stringliteral}{"  "});          \textcolor{comment}{// indent the name}
148     strcat (buffer, name);                                  \textcolor{comment}{// put the name}
149     strcat (buffer, (\hyperlink{kfs_8c_a8d546cf291d26ab01a150b74cc206ae1}{kfs\_type}(inode)==\hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{KFS\_DIR})?\textcolor{stringliteral}{"/"}:\textcolor{stringliteral}{" "});    \textcolor{comment}{// add  / for a diectory}
150     \textcolor{keywordflow}{for} (l = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(buffer); l<30; l++) buffer[l]=\textcolor{charliteral}{' '};      \textcolor{comment}{// complete until 30 character}
151     buffer[l]=0;                                            \textcolor{comment}{// end the buffer}
152     printf (\textcolor{stringliteral}{"d%-2x>i%-2x "}                                  \textcolor{comment}{// dentry -> inode}
153             \textcolor{stringliteral}{"%c%c%c%c%c%c%c %3d %s %7d %d "}                 \textcolor{comment}{// inode data}
154             \textcolor{stringliteral}{"<%-2xv%-2x>%-2x %s"},                           \textcolor{comment}{// dentry tree structure}
155             dentry, inode,                                  \textcolor{comment}{//}
156             types[\hyperlink{kfs_8c_a8d546cf291d26ab01a150b74cc206ae1}{kfs\_type}(inode)],                         \textcolor{comment}{// inode type}
157             (\hyperlink{kfs_8c_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\_mode}(inode) & 0b100000)  ? \textcolor{charliteral}{'r'} : \textcolor{charliteral}{'-'},      \textcolor{comment}{// inode permission mode}
158             (\hyperlink{kfs_8c_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\_mode}(inode) & 0b010000)  ? \textcolor{charliteral}{'w'} : \textcolor{charliteral}{'-'},
159             (\hyperlink{kfs_8c_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\_mode}(inode) & 0b001000)  ? \textcolor{charliteral}{'x'} : \textcolor{charliteral}{'-'},
160             (\hyperlink{kfs_8c_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\_mode}(inode) & 0b000100)  ? \textcolor{charliteral}{'r'} : \textcolor{charliteral}{'-'},
161             (\hyperlink{kfs_8c_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\_mode}(inode) & 0b000010)  ? \textcolor{charliteral}{'w'} : \textcolor{charliteral}{'-'},
162             (\hyperlink{kfs_8c_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\_mode}(inode) & 0b000001)  ? \textcolor{charliteral}{'x'} : \textcolor{charliteral}{'-'},
163             \hyperlink{kfs_8c_aaa0d81604e0d3d23f31b3beb7dcb163c}{kfs\_count}(inode),                               \textcolor{comment}{// inode references counter}
164             owners[\hyperlink{kfs_8c_a2f522cb4edeecd6cbcebcca31d90bc75}{kfs\_owner}(inode)],                       \textcolor{comment}{// inode owner}
165             \hyperlink{kfs_8c_a2e7cb7a15052f57bdff8a2c1146bc072}{kfs\_size}(inode),                                \textcolor{comment}{// inode size}
166             \hyperlink{kfs_8c_a9b41dd15430924703df46a579ff05b2e}{kfs\_mtime}(inode),                               \textcolor{comment}{// inode relative modification time}
167             \hyperlink{kfs_8c_ade5bf93265bc86a9ecd5019cc6e3d277}{kfs\_root}(dentry),                               \textcolor{comment}{// dentry structure}
168             \hyperlink{kfs_8c_a3be0d586ff3044979a3c381137d77d47}{kfs\_next}(dentry),
169             \hyperlink{kfs_8c_a135f3848117282c89e3be09b930eb9de}{kfs\_leaf}(dentry),
170             buffer);                                        \textcolor{comment}{// entry name}
171     \textcolor{keywordtype}{int} offset = 0;                                         \textcolor{comment}{// offset in file}
172     \textcolor{keywordtype}{int} page = \hyperlink{kfs_8c_afdc75626536d311fb2fe47baef24ef55}{kfs\_page} (inode, offset++);                  \textcolor{comment}{// first page number (-1 if ended)}
173     \textcolor{keywordflow}{while} (page >= 0) \{                                     \textcolor{comment}{// while there are pages}
174         printf (\textcolor{stringliteral}{"%3d"}, page);                               \textcolor{comment}{// print page number in disk}
175         page = \hyperlink{kfs_8c_afdc75626536d311fb2fe47baef24ef55}{kfs\_page} (inode, offset++);                  \textcolor{comment}{// find the next}
176     \}
177     printf (\textcolor{stringliteral}{"\(\backslash\)n"});                                          \textcolor{comment}{// at last change the line}
178 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a1ba276cff72866fb0ad856572a87ba35}{\index{ktools.\-c@{ktools.\-c}!kfs\-\_\-print\-\_\-files@{kfs\-\_\-print\-\_\-files}}
\index{kfs\-\_\-print\-\_\-files@{kfs\-\_\-print\-\_\-files}!ktools.c@{ktools.\-c}}
\subsubsection[{kfs\-\_\-print\-\_\-files}]{\setlength{\rightskip}{0pt plus 5cm}void kfs\-\_\-print\-\_\-files (
\begin{DoxyParamCaption}
\item[{int}]{dentry, }
\item[{int}]{depth, }
\item[{int}]{position}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a1ba276cff72866fb0ad856572a87ba35}


References buffer, kfs\-\_\-absolute\-\_\-pathname(), K\-F\-S\-\_\-\-F\-I\-L\-E, kfs\-\_\-inode(), kfs\-\_\-read(), kfs\-\_\-size(), kfs\-\_\-type(), memset(), and write().



Referenced by kfs\-\_\-files().


\begin{DoxyCode}
186 \{
187     \textcolor{keywordtype}{int} inode = \hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\_inode}(dentry);
188     \textcolor{keywordtype}{int} \hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size} = \hyperlink{kfs_8c_a2e7cb7a15052f57bdff8a2c1146bc072}{kfs\_size}(inode);
189     \textcolor{keywordtype}{int} pg\_offset = 0;
190 
191     printf(\textcolor{stringliteral}{"\(\backslash\)n%s\(\backslash\)n"}, \hyperlink{ktools_8c_a30830920b754d844291af7d136d6b5c1}{kfs\_absolute\_pathname}(dentry));
192 
193     \textcolor{keywordflow}{if} (size == 0) \textcolor{keywordflow}{return};
194 
195     \textcolor{keywordflow}{if} (\hyperlink{kfs_8c_a8d546cf291d26ab01a150b74cc206ae1}{kfs\_type}(inode) == \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}{KFS\_FILE}) \{
196         \textcolor{keywordflow}{while} (pg\_offset<<12 < size)
197         \{
198             \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset} (\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 0, 1<<12);
199             \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read}(dentry, pg\_offset, (\textcolor{keywordtype}{void} *) \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer});
200             \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write}(STDOUT\_FILENO, \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 1<<12);
201             pg\_offset++;
202         \}
203         printf(\textcolor{stringliteral}{"\(\backslash\)n"});
204     \}
205 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a54c8f883a16767e5c05750fc425c525c}{\index{ktools.\-c@{ktools.\-c}!kfs\-\_\-tree@{kfs\-\_\-tree}}
\index{kfs\-\_\-tree@{kfs\-\_\-tree}!ktools.c@{ktools.\-c}}
\subsubsection[{kfs\-\_\-tree}]{\setlength{\rightskip}{0pt plus 5cm}void kfs\-\_\-tree (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a54c8f883a16767e5c05750fc425c525c}


References kfs\-\_\-open(), kfs\-\_\-print\-\_\-dentry(), and kfs\-\_\-tree\-\_\-cb().



Referenced by dummy\-\_\-disk(), and main().


\begin{DoxyCode}
181 \{
182     \hyperlink{kfs_8c_a0c8753d9a11f6570f9c56b587fa2c48c}{kfs\_tree\_cb} (\hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open}(name), \hyperlink{ktools_8c_a248e1d9ae859f3b9f7933b506846c667}{kfs\_print\_dentry});         \textcolor{comment}{// call
       kfs\_print\_dentry for all entry}
183 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a0ddf1224851353fc92bfbff6f499fa97}{\index{ktools.\-c@{ktools.\-c}!main@{main}}
\index{main@{main}!ktools.c@{ktools.\-c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a0ddf1224851353fc92bfbff6f499fa97}


References add\-\_\-new\-\_\-file(), Boot\-File\-Name, build(), C\-M\-D\-\_\-\-B\-U\-I\-L\-D, C\-M\-D\-\_\-\-D\-U\-M\-M\-Y, C\-M\-D\-\_\-\-S\-P\-L\-I\-T, C\-M\-D\-\_\-\-T\-R\-E\-E, Command, Dir\-Name, dummy\-\_\-disk(), exit(), fprintf(), getoption(), kfs\-\_\-add\-\_\-mbr(), kfs\-\_\-add\-\_\-vbr(), kfs\-\_\-disk\-\_\-load(), kfs\-\_\-disk\-\_\-save(), kfs\-\_\-files(), kfs\-\_\-open(), kfs\-\_\-tree(), kfs\-\_\-tree\-\_\-cb(), Kfs\-Disk\-Name, Mbr\-File\-Name, Opt\-C\-New\-File, Opt\-C\-Pathname, Opt\-F, and split().



Referenced by \-\_\-start().


\begin{DoxyCode}
511 \{
512     \hyperlink{ktools_8c_a78949f4960804d06e92c2b349740243f}{getoption} (argc, argv);
513 
514     \textcolor{keywordflow}{switch} (\hyperlink{ktools_8c_a36c5506122899541315d168541f135f6}{Command}) \{
515 
516         \textcolor{keywordflow}{case} \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5}{CMD\_DUMMY}:
517             \hyperlink{ktools_8c_a9b68125aeb10ab39a0981d0fa952d5f1}{dummy\_disk}();
518             \hyperlink{kfs_8h_a3037ba33f12f2c2c99e099f9cc4a71e6}{kfs\_disk\_save} (\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
519             \textcolor{keywordflow}{break};
520 
521         \textcolor{keywordflow}{case} \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457}{CMD\_TREE}:
522             \hyperlink{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{kfs\_disk\_load} (\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
523             \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_aebd6c8ef38afc2cfd9a6db1ed746e28d}{OptF}) \{
524                 \hyperlink{ktools_8c_a2acd3e2ba6581eac5ff5e2a78ffa9bd8}{kfs\_files}(\textcolor{stringliteral}{"/"});
525             \}
526             \textcolor{keywordflow}{else} \{
527                 \hyperlink{ktools_8c_a54c8f883a16767e5c05750fc425c525c}{kfs\_tree}(\textcolor{stringliteral}{"/"});
528             \}
529             \textcolor{keywordflow}{break};
530 
531         \textcolor{keywordflow}{case} \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5}{CMD\_BUILD}:
532             \textcolor{comment}{/* Add an MBR if one was provided */}
533             \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{MbrFileName})
534             \{
535                 \textcolor{keywordflow}{if} (!\hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}) \{
536                     \hyperlink{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{kfs\_disk\_load} (\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
537                 \}
538                 \hyperlink{kfs_8h_af88c339569eb51ffc1d94ee2324202f5}{kfs\_add\_mbr}(\hyperlink{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{MbrFileName});
539             \}
540 
541             \textcolor{comment}{/* Add a kernel bootloader if one was provided */}
542             \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{BootFileName})
543             \{
544                 \textcolor{keywordflow}{if} (!\hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}) \{
545                     \hyperlink{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{kfs\_disk\_load} (\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
546                 \}
547                 \hyperlink{kfs_8h_a13b2ba4b6ae24b6b49ce962a44e4e5fa}{kfs\_add\_vbr}(\hyperlink{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{BootFileName});
548             \}
549 
550             \textcolor{comment}{/* Build without any options = build from linux directory */}
551             \textcolor{keywordflow}{if} (!\hyperlink{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{OptCPathname}) \{
552 
553                 \textcolor{comment}{/* Walk through the linux directory and write its content in kfs */}
554                 \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}) nftw(\hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}, \hyperlink{ktools_8c_a521c1fd005bd6738b695d604843e880c}{build}, 20, 0);
555             \}
556 
557             \textcolor{comment}{/* Build with c option = add a file to a pathname on an existing disk */}
558             \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{OptCPathname})
559             \{
560                 \textcolor{comment}{/* Charge the disk to modify in kfs (if it wasn't charged before) */}
561                 \textcolor{keywordflow}{if} (!(\hyperlink{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{MbrFileName} || \hyperlink{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{BootFileName})) \{
562                     \textcolor{keywordflow}{if} (\hyperlink{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{kfs\_disk\_load} (\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName}) <= 0) \{
563                         \hyperlink{libc_8c_a4e7edf0e8df09b47566d572e19dad429}{fprintf} (stderr, \textcolor{stringliteral}{"Could not load %s\(\backslash\)n"}, 
      \hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
564                         \hyperlink{klibc_8c_a55e99c539cf7723ec15e856b7e0a8cee}{exit}(1);
565                     \}
566                 \}
567 
568                 \textcolor{comment}{/* Create (or open) the pathname in kfs */}
569                 \textcolor{keywordtype}{int} kfs\_dentry = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open}(\hyperlink{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{OptCPathname});
570 
571                 \textcolor{comment}{/* If the user provided a filename from the host, try to write its content in kfs */}
572                 \textcolor{keywordflow}{if} (\hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{OptCNewFile})
573                 \{
574                     \hyperlink{ktools_8c_a39f344acada2bd8574dfb5da41938905}{add\_new\_file}(\hyperlink{ktools_8c_a12af974a09824ae8357cae0737368e61}{OptCNewFile}, kfs\_dentry);
575                 \}
576             \}
577 
578             \textcolor{comment}{/* Lastly, save the new (or modified) kfs disk on host */}
579             \hyperlink{kfs_8h_a3037ba33f12f2c2c99e099f9cc4a71e6}{kfs\_disk\_save}(\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
580 
581             \textcolor{keywordflow}{break};
582 
583         \textcolor{keywordflow}{case} \hyperlink{ktools_8c_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921}{CMD\_SPLIT}:
584             \textcolor{comment}{/* First, load the kfs disk from host */}
585             \hyperlink{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{kfs\_disk\_load} (\hyperlink{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{KfsDiskName});
586 
587             \textcolor{comment}{/* Create the host directory where the kfs disk will be split */}
588             \textcolor{comment}{//mkdir(DirName, 0777);}
589 
590             \textcolor{comment}{/* Now we can walk through this kfs disk and write its content to the host directory */}
591             \hyperlink{kfs_8c_a0c8753d9a11f6570f9c56b587fa2c48c}{kfs\_tree\_cb}(0, \hyperlink{ktools_8c_a16c0ecb37b34e241fab9b9be0ebf7c6f}{split});
592 
593             \textcolor{keywordflow}{break};
594     \}
595     \textcolor{keywordflow}{return} 0;
596 \}
\end{DoxyCode}
\hypertarget{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}{\index{ktools.\-c@{ktools.\-c}!mess@{mess}}
\index{mess@{mess}!ktools.c@{ktools.\-c}}
\subsubsection[{mess}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ mess (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{ktools_8c_ad6d27cfbe08c4d6edb2d552d23e5396f}


References buffer, and memset().



Referenced by dummy\-\_\-disk().


\begin{DoxyCode}
217 \{
218     \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset} (\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 0, 1<<12);
219     sprintf (\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, \textcolor{stringliteral}{"%s"}, s);
220     \textcolor{keywordflow}{return} \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer};
221 \}
\end{DoxyCode}
\hypertarget{ktools_8c_a16c0ecb37b34e241fab9b9be0ebf7c6f}{\index{ktools.\-c@{ktools.\-c}!split@{split}}
\index{split@{split}!ktools.c@{ktools.\-c}}
\subsubsection[{split}]{\setlength{\rightskip}{0pt plus 5cm}void split (
\begin{DoxyParamCaption}
\item[{int}]{dentry, }
\item[{int}]{depth, }
\item[{int}]{position}
\end{DoxyParamCaption}
)}}\label{ktools_8c_a16c0ecb37b34e241fab9b9be0ebf7c6f}


References buffer, Dir\-Name, free(), kfs\-\_\-absolute\-\_\-pathname(), K\-F\-S\-\_\-\-D\-I\-R, K\-F\-S\-\_\-\-F\-I\-L\-E, kfs\-\_\-inode(), kfs\-\_\-read(), kfs\-\_\-size(), kfs\-\_\-type(), malloc(), memset(), strlen(), strncpy(), and write().



Referenced by main().


\begin{DoxyCode}
365 \{
366     \textcolor{comment}{/* If this is the root, nothing needs to be done */}
367     \textcolor{keywordflow}{if} (!dentry) \textcolor{keywordflow}{return};
368 
369     \textcolor{comment}{/* Get inode information about this dentry and create the string for the new pathname on host */}
370     \textcolor{keywordtype}{int} inode = \hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\_inode}(dentry);
371     \textcolor{keywordtype}{int} \hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size} = \hyperlink{kfs_8c_a2e7cb7a15052f57bdff8a2c1146bc072}{kfs\_size}(inode);
372     \textcolor{keywordtype}{char}* absolute = \hyperlink{ktools_8c_a30830920b754d844291af7d136d6b5c1}{kfs\_absolute\_pathname}(dentry);
373     \textcolor{keywordtype}{char}* new\_path = \hyperlink{memory_8c_a7ac38fce3243a7dcf448301ee9ffd392}{malloc}(\hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(absolute) + \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(\hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}) + 1);
374     \hyperlink{cstd_8c_a4803fe91b443c6cb7b6d21784aee33b0}{strncpy}(new\_path, \hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}, \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(\hyperlink{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{DirName}));
375     strcat(new\_path, absolute);
376 
377     printf(\textcolor{stringliteral}{"%s\(\backslash\)n"}, new\_path);
378 
379     \textcolor{comment}{/* If it is a directory, create it on host */}
380     \textcolor{keywordflow}{if} (\hyperlink{kfs_8c_a8d546cf291d26ab01a150b74cc206ae1}{kfs\_type}(inode) == \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{KFS\_DIR})
381     \{
382         mkdir(new\_path, 0777);
383         \hyperlink{memory_8c_afbedc913aa4651b3c3b4b3aecd9b4711}{free}(new\_path);
384         \textcolor{keywordflow}{return};
385     \}
386 
387     \textcolor{comment}{/* If it is a file, create it and write its content on host */}
388     \textcolor{keywordflow}{if} (\hyperlink{kfs_8c_a8d546cf291d26ab01a150b74cc206ae1}{kfs\_type}(inode) == \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}{KFS\_FILE})
389     \{
390         \textcolor{keywordtype}{int} fd = open(new\_path, O\_RDWR | O\_CREAT | O\_TRUNC, 0666);
391         \textcolor{keywordtype}{int} page\_offset = 0;
392         \textcolor{comment}{/* Write every page but the last */}
393         \textcolor{keywordflow}{while}(((page\_offset<<12) + (1<<12)) <= size)
394         \{
395             \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset}(\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 0, 1<<12);
396             \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read}(dentry, page\_offset, (\textcolor{keywordtype}{void}*) \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer});
397             \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write}(fd, \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 1<<12);
398             page\_offset++;
399         \}
400         \textcolor{comment}{/* Write the last page */}
401         \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset}(\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, 0, 1<<12);
402         \hyperlink{kfs_8c_a532e7e965bd6809645bdf682ffd509dc}{kfs\_read}(dentry, page\_offset, (\textcolor{keywordtype}{void}*) \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer});
403         \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write}(fd, \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}, \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}));
404 
405         \hyperlink{memory_8c_afbedc913aa4651b3c3b4b3aecd9b4711}{free}(new\_path);
406         \textcolor{keywordflow}{return};
407     \}
408 \}
\end{DoxyCode}
\hypertarget{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}{\index{ktools.\-c@{ktools.\-c}!strdup@{strdup}}
\index{strdup@{strdup}!ktools.c@{ktools.\-c}}
\subsubsection[{strdup}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ strdup (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{ktools_8c_ab1cc1a3ff560049e22576031c7c2345b}


Referenced by getoption().

\hypertarget{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}{\index{ktools.\-c@{ktools.\-c}!usage@{usage}}
\index{usage@{usage}!ktools.c@{ktools.\-c}}
\subsubsection[{usage}]{\setlength{\rightskip}{0pt plus 5cm}void usage (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{ktools_8c_ae8605e2b78cd4a81b6c6b5c30cb7366a}


References Argv, and exit().



Referenced by getoption().


\begin{DoxyCode}
415 \{
416     printf (\textcolor{stringliteral}{"\(\backslash\)nUsage : %s [-h] [-v level] [-m mbr] [-b boot] [-c pathname]\(\backslash\)n"}, 
      \hyperlink{ktools_8c_ab4fad31452ea2612bd37240026dd6e44}{Argv}[0]);
417     printf (\textcolor{stringliteral}{"                  <command> <kfsd> [dir]\(\backslash\)n\(\backslash\)n"});
418     printf (\textcolor{stringliteral}{"         -h  this help\(\backslash\)n"});
419     printf (\textcolor{stringliteral}{"         -v  verbose mode level (0, 1, 2)\(\backslash\)n"});
420     printf (\textcolor{stringliteral}{"     -m mbr  mbr executable file\(\backslash\)n"});
421     printf (\textcolor{stringliteral}{"    -b boot  bootloader executable file\(\backslash\)n"});
422     \textcolor{comment}{//printf (" -c pathname copy file pathname\(\backslash\)n");}
423     printf (\textcolor{stringliteral}{"    command  < tree | build | split | dummy >\(\backslash\)n"});
424     printf (\textcolor{stringliteral}{"       kfsd  kfs disk name (with .kfs extension) \(\backslash\)n"});
425     printf (\textcolor{stringliteral}{"        dir  Linux directory\(\backslash\)n"});
426     printf (\textcolor{stringliteral}{"\(\backslash\)n"});
427     \hyperlink{klibc_8c_a55e99c539cf7723ec15e856b7e0a8cee}{exit} (1);
428 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{ktools_8c_a34296df812d7c5468ae201c7eeca5877}{\index{ktools.\-c@{ktools.\-c}!Argc@{Argc}}
\index{Argc@{Argc}!ktools.c@{ktools.\-c}}
\subsubsection[{Argc}]{\setlength{\rightskip}{0pt plus 5cm}int Argc}}\label{ktools_8c_a34296df812d7c5468ae201c7eeca5877}


Referenced by getoption().

\hypertarget{ktools_8c_ab4fad31452ea2612bd37240026dd6e44}{\index{ktools.\-c@{ktools.\-c}!Argv@{Argv}}
\index{Argv@{Argv}!ktools.c@{ktools.\-c}}
\subsubsection[{Argv}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$$\ast$ Argv}}\label{ktools_8c_ab4fad31452ea2612bd37240026dd6e44}


Referenced by getoption(), and usage().

\hypertarget{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}{\index{ktools.\-c@{ktools.\-c}!Boot\-File\-Name@{Boot\-File\-Name}}
\index{Boot\-File\-Name@{Boot\-File\-Name}!ktools.c@{ktools.\-c}}
\subsubsection[{Boot\-File\-Name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ Boot\-File\-Name}}\label{ktools_8c_ad451cda91ce9d9c54ee261e4ec46e2c8}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{\index{ktools.\-c@{ktools.\-c}!buffer@{buffer}}
\index{buffer@{buffer}!ktools.c@{ktools.\-c}}
\subsubsection[{buffer}]{\setlength{\rightskip}{0pt plus 5cm}char buffer\mbox{[}1$<$$<$ 12\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}


Referenced by add\-\_\-new\-\_\-file(), dummy\-\_\-disk(), fprintf(), kfs\-\_\-print\-\_\-dentry(), kfs\-\_\-print\-\_\-files(), kfs\-\_\-write\-\_\-page(), kprintf(), mess(), split(), and vsnprintf().

\hypertarget{ktools_8c_a36c5506122899541315d168541f135f6}{\index{ktools.\-c@{ktools.\-c}!Command@{Command}}
\index{Command@{Command}!ktools.c@{ktools.\-c}}
\subsubsection[{Command}]{\setlength{\rightskip}{0pt plus 5cm}int Command}}\label{ktools_8c_a36c5506122899541315d168541f135f6}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}{\index{ktools.\-c@{ktools.\-c}!Dir\-Name@{Dir\-Name}}
\index{Dir\-Name@{Dir\-Name}!ktools.c@{ktools.\-c}}
\subsubsection[{Dir\-Name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ Dir\-Name}}\label{ktools_8c_a68cc4e6509205eeddea8429d2c05f2fe}


Referenced by getoption(), main(), and split().

\hypertarget{ktools_8c_af66cf6e5961e8522172d89532df9db9d}{\index{ktools.\-c@{ktools.\-c}!Kfs\-Disk\-Name@{Kfs\-Disk\-Name}}
\index{Kfs\-Disk\-Name@{Kfs\-Disk\-Name}!ktools.c@{ktools.\-c}}
\subsubsection[{Kfs\-Disk\-Name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ Kfs\-Disk\-Name}}\label{ktools_8c_af66cf6e5961e8522172d89532df9db9d}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}{\index{ktools.\-c@{ktools.\-c}!Mbr\-File\-Name@{Mbr\-File\-Name}}
\index{Mbr\-File\-Name@{Mbr\-File\-Name}!ktools.c@{ktools.\-c}}
\subsubsection[{Mbr\-File\-Name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ Mbr\-File\-Name}}\label{ktools_8c_a58ccf99eba46ba1428531b6cab7fe47d}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_a12af974a09824ae8357cae0737368e61}{\index{ktools.\-c@{ktools.\-c}!Opt\-C\-New\-File@{Opt\-C\-New\-File}}
\index{Opt\-C\-New\-File@{Opt\-C\-New\-File}!ktools.c@{ktools.\-c}}
\subsubsection[{Opt\-C\-New\-File}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ Opt\-C\-New\-File}}\label{ktools_8c_a12af974a09824ae8357cae0737368e61}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_a9267a5326b000eb299265df069cdcaf7}{\index{ktools.\-c@{ktools.\-c}!Opt\-C\-Pathname@{Opt\-C\-Pathname}}
\index{Opt\-C\-Pathname@{Opt\-C\-Pathname}!ktools.c@{ktools.\-c}}
\subsubsection[{Opt\-C\-Pathname}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ Opt\-C\-Pathname}}\label{ktools_8c_a9267a5326b000eb299265df069cdcaf7}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_aebd6c8ef38afc2cfd9a6db1ed746e28d}{\index{ktools.\-c@{ktools.\-c}!Opt\-F@{Opt\-F}}
\index{Opt\-F@{Opt\-F}!ktools.c@{ktools.\-c}}
\subsubsection[{Opt\-F}]{\setlength{\rightskip}{0pt plus 5cm}int Opt\-F = 0}}\label{ktools_8c_aebd6c8ef38afc2cfd9a6db1ed746e28d}


Referenced by getoption(), and main().

\hypertarget{ktools_8c_a95f627d7054b1abbffa2c6ea19bf05db}{\index{ktools.\-c@{ktools.\-c}!Verbose@{Verbose}}
\index{Verbose@{Verbose}!ktools.c@{ktools.\-c}}
\subsubsection[{Verbose}]{\setlength{\rightskip}{0pt plus 5cm}int Verbose}}\label{ktools_8c_a95f627d7054b1abbffa2c6ea19bf05db}


Referenced by getoption().

